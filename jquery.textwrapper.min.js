/**
* jQuery Text Wrapper
* @author: jsimonait <jsimonait@gmail.com>
*/
(function(b){b.fn.textwrap=function(f,n){return b.textWrapper.wrap(b(this),f,n)};b.fn.textunwrap=function(f){b.textWrapper.unwrap(b(this),f)};b.textWrapper=new function(){var f=this;this.options={dataTextName:"text",createPattern:function(a){return RegExp("()("+a+")()","g")}};this.wrap=function(a,g,d,e){e=b.extend(this.options,e||{});var h=[];a=b(a);a.html(q(a.html()));a.each(function(a,l){if("undefined"!=typeof g.push)for(a in g)b.merge(h,n(l,g[a],d,e));else b.merge(h,n(l,g,d,e))});return h};this.unwrap=
function(a,g,d){d=b.extend(this.options,d||{});var e=function(a,b){a.find("[data-"+d.dataTextName+'="'+b+'"]').each(function(a,b){var c=b.parentNode;c.insertBefore(b.firstChild,b);c.removeChild(b);c.normalize()})};b(a).each(function(a,d){if("undefined"!=typeof g.push)for(a in g)e(b(d),g[a]);else e(b(d),g)})};this.find=function(a,b,d){a=p(a);for(var e=a.childNodes.length;0<e--;){var h=a.childNodes[e];if(1==h.nodeType)f.find(h,b,d);else if(3==h.nodeType){for(var m=[],l;l=b.exec(h.data);)m.push(l);for(l=
m.length;0<l--;)d.call(window,h,m[l])}}};var n=function(a,g,d,e){var h=[];e=b.extend(f.options,e||{});a=p(a);var m=e.createPattern(g);f.find(a,m,function(a,b){if(!a.parentNode.getAttribute("data-"+e.dataTextName)){var c=d,k;if("string"==typeof c)k=document.createElement(c);else{c instanceof jQuery&&(c=c.get(0));k=document.createElement(c.tagName);for(var c=c.attributes,f=0;f<c.length;f++)k.setAttribute(c[f].nodeName,c[f].nodeValue)}d=k;d.setAttribute("data-"+e.dataTextName,g);c=2;if(!b[0])throw"textWrapper cannot handle zero-length matches";
k=b.index;if(0<c){c=b[c];if(!c)throw"Invalid capture group";k+=b[0].indexOf(c);b[0]=c}k=[k,k+b[0].length,[b[0]]];a.splitText(k[1]);d.appendChild(a.splitText(k[0]));a.parentNode.insertBefore(d,a.nextSibling);h.push(d)}});return h},p=function(a){a instanceof jQuery&&(a=1==a.length?a.get(0):a.get());return a},q=function(a){a=""+a;a=b("<div />").html(a).html();return a=a.replace(/\xA0|\s+|(&nbsp;)/mg," ")}}})(jQuery);